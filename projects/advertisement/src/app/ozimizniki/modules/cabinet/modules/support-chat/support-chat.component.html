<div class="support">
  <div nz-row>
    <div nz-col nzSpan="24">
      <div nz-row [nzGutter]="[0, 4]" class="support__head">
        <div class="support__head__status" nz-col nzSpan="24">
          <div nz-row [nzGutter]="[0, 4]">
            <div nz-col nzSpan="24">
              <h3>Техподдержка Agrozamin</h3>
            </div>
            <div nz-col>
              <span [ngClass]="isOnline ? 'green' : 'grey'"></span
              ><span>{{
                (isOnline ? "nowOnline" : "notOnline") | translate
              }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      style="padding-top: 24px"
      nz-col
      nzXs="24"
      nzSm="24"
      nzMd="24"
      nzLg="24"
      nzXl="24"
    >
      <div
        nz-row
        class="support__body"
        #scrollMe
        (scroll)="onScrollEvent($event)"
      >
        <div nz-col nzSpan="24" class="support__body__user">
          <ng-container
            *ngFor="let messageMapItem of messagesByDate | keyvalue"
          >
            <!-- DATE -->
            <div nz-col nzSpan="24">
              <div nz-row nzJustify="center">
                <div nz-col>
                  <div class="support__body__date">
                    <p>{{ messageMapItem.key }}</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- MESSAGES -->
            <ng-container *ngFor="let message of messageMapItem.value">
              <div
                class="support__body__user__message"
                [ngClass]="message.owner ? 'right' : 'left'"
              >
                <p>{{ message.text }}</p>
                <span>{{ message.created_at | date: "HH:mm" }}</span>
              </div>

              <div
                class="support__body__user__message image"
                [ngClass]="message.owner ? 'right' : 'left'"
                *ngIf="message.file as image"
              >
                <nz-spin
                  [nzSpinning]="message.isLoading"
                  *ngIf="!message.deleted"
                >
                  <img [src]="image" (click)="viewImage(image)" />
                  <div class="image__error" *ngIf="message.hasError">
                    <button
                      nz-button
                      nzType="default"
                      nzShape="circle"
                      nzSize="small"
                      (click)="reUpload(message)"
                    >
                      <i nz-icon nzType="reload" nzTheme="outline"></i>
                    </button>
                    <button
                      nz-button
                      nzType="default"
                      nzShape="circle"
                      nzSize="small"
                      (click)="cancelUploadingImage(message)"
                    >
                      <i nz-icon nzType="close" nzTheme="outline"></i>
                    </button>
                  </div>
                </nz-spin>
              </div>
            </ng-container>
          </ng-container>
        </div>
      </div>
    </div>
    <div class="support__footer" nz-col nzSpan="24">
      <form (ngSubmit)="sendMessage(message)">
        <nz-input-group
          nzSize="large"
          [nzSuffix]="suffixTemplateInfo"
          [nzPrefix]="prefixTemplateUser"
        >
          <input
            type="text"
            nz-input
            placeholder="Написать сообщение"
            [(ngModel)]="message"
            [ngModelOptions]="{ standalone: true }"
          />
        </nz-input-group>
        <ng-template #prefixTemplateUser>
          <i nz-button (click)="uploadImage.click()" class="pointer">
            <img src="/assets/images/attach.png" alt="" />
          </i>

          <input
            hidden
            #uploadImage
            type="file"
            (change)="handleImagesInput($event)"
            multiple="false"
            accept="image/png, image/jpeg"
          />
        </ng-template>

        <ng-template #suffixTemplateInfo>
          <!-- TODO: REMOVE OR IMPLEMENT -->
          <!-- <i nz-icon><img src="/assets/images/emoji.png" alt="" /></i> -->
          <button nz-button>
            <img src="/assets/images/send-attach.png" alt="" />
          </button>
        </ng-template>
      </form>
    </div>
  </div>
</div>
